---
import OrderForm from '~/components/order/OrderForm'
import Layout from '~/layouts/Layout.astro'
import { prisma } from 'schema'

let product = await prisma.product.findUniqueOrThrow({
  where: { id: Astro.params.productId as string },
  select: {
    id: true,
    name: true,
    image: true,
    price: true,
    quantity: true,
    remainQuantity: true,
  },
})

if (product.remainQuantity === 0) {
  return Astro.redirect(`/products/${product.id}`)
}

product.price = product.price.toString()
---

<Layout title={product.name}>
  <OrderForm client:visible product={product} />
</Layout>
